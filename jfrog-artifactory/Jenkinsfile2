node {
    def server = Artifactory.server "zayinochoa.jfrog.io"
    def rtGradle = Artifactory.newGradleBuild()
    
    stage ('Clone') {
        git branch: 'main', url: 'https://github.com/macloujulian/gs-gradle.git'
    }

    stage ('Artifactory configuration') {
        rtGradle.tool = 'gradle' // Como le asignamos al nombre de la herramienta en Jenkins en configuraci√≥n
        rtGradle.deployer releaseRepo: 'default-gradle-dev-local', snapshotRepo: 'libs-snapshot-local', server: server
        rtGradle.resolver releaseRepo: 'default-gradle-dev', snapshotRepo: 'libs-snapshot', server: server
        buildInfo = Artifactory.newBuildInfo()
        buildInfo.env.capture = true
        buildInfo.env.filter.addInclude("*")
    }

    stage ('Ejecutar Gradle') {
        rtGradle.run rootDir: 'gradle-example/artifactory/', tasks: 'clean artifactoryPublish', buildInfo: buildInfo
    }

    stage ('Publish build info') {
        server.publishBuildInfo buildInfo
    }
}
